module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},62212,a=>{a.n(a.i(66114))},44067,a=>{a.n(a.i(36102))},96182,a=>{"use strict";a.s(["calculateArea",()=>b,"calculatePerimeter",()=>c,"formatArea",()=>e,"formatPerimeter",()=>f]);let b=a=>{if(a.length<3)return 0;let b=0,c=a.length;for(let d=0;d<c;d++){let e=(d+1)%c;b+=a[d].lng*a[e].lat,b-=a[e].lng*a[d].lat}return(b=Math.abs(b)/2)*(6371e3*Math.cos(a[0].lat*Math.PI/180)*6371e3)},c=a=>{if(a.length<2)return 0;let b=0,c=a.length;for(let e=0;e<c;e++){let f=(e+1)%c;b+=d(a[e],a[f])}return b},d=(a,b)=>{let c=(b.lat-a.lat)*Math.PI/180,d=(b.lng-a.lng)*Math.PI/180,e=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2);return 2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))*6371e3},e=a=>a<1e3?`${Math.round(a)} م\xb2`:a<1e4?`${(a/1e3).toFixed(1)} ألف م\xb2`:`${Math.round(a/1e3)} ألف م\xb2`,f=a=>a<1e3?`${Math.round(a)} م`:`${(a/1e3).toFixed(1)} كم`},34820,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/app/admin/projects/[id]/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/admin/projects/[id]/page.tsx <module evaluation>","default")},76040,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/app/admin/projects/[id]/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/admin/projects/[id]/page.tsx","default")},46289,a=>{"use strict";a.i(34820);var b=a.i(76040);a.n(b)},37540,a=>a.a(async(b,c)=>{try{a.s(["createPlot",()=>m,"deletePlot",()=>o,"getAvailableProperties",()=>r,"getProjectPlots",()=>q,"updatePlot",()=>n]);var d=a.i(37936),e=a.i(18558),f=a.i(41462),g=a.i(30316),h=a.i(55742),i=a.i(99901),j=a.i(96182),k=a.i(13095),l=b([f,g,h]);async function m(a){try{await (0,f.requireAdmin)();let b=i.plotSchema.parse(a),c={area:(0,j.calculateArea)(b.polygon),perimeter:(0,j.calculatePerimeter)(b.polygon)},d={...b,dimensions:c,createdAt:h.FieldValue.serverTimestamp(),updatedAt:h.FieldValue.serverTimestamp()},k=await g.adminDb.collection("plots").add(d),l=await k.get(),m=l.data(),n={id:l.id,projectId:m.projectId,number:m.number,status:m.status,price:m.price,currency:m.currency,polygon:m.polygon,dimensions:m.dimensions,notes:m.notes,propertyId:m.propertyId,createdAt:m.createdAt?.toDate()||new Date,updatedAt:m.updatedAt?.toDate()||new Date};return(0,e.revalidatePath)(`/admin/projects/${a.projectId}`),(0,e.revalidatePath)(`/projects/${a.projectId}`),{success:!0,data:n}}catch(a){return console.error("Error creating plot:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء إنشاء القطعة"}}}async function n(a,b){try{await (0,f.requireAdmin)();let c=await g.adminDb.collection("plots").doc(a).get();if(!c.exists)return{success:!1,error:"القطعة غير موجودة"};let d=c.data();Object.keys(b).length>0&&i.plotSchema.partial().parse(b);let k=d.dimensions;b.polygon&&(k={area:(0,j.calculateArea)(b.polygon),perimeter:(0,j.calculatePerimeter)(b.polygon)});let l={...b,dimensions:k,updatedAt:h.FieldValue.serverTimestamp()};await g.adminDb.collection("plots").doc(a).update(l);let m=await g.adminDb.collection("plots").doc(a).get(),n=m.data(),o={id:m.id,projectId:n.projectId,number:n.number,status:n.status,price:n.price,currency:n.currency,polygon:n.polygon,dimensions:n.dimensions,notes:n.notes,propertyId:n.propertyId,createdAt:n.createdAt?.toDate()||new Date,updatedAt:n.updatedAt?.toDate()||new Date};return(0,e.revalidatePath)(`/admin/projects/${o.projectId}`),(0,e.revalidatePath)(`/projects/${o.projectId}`),{success:!0,data:o}}catch(a){return console.error("Error updating plot:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء تحديث القطعة"}}}async function o(a){try{await (0,f.requireAdmin)();let b=await g.adminDb.collection("plots").doc(a).get();if(!b.exists)return{success:!1,error:"القطعة غير موجودة"};let c=b.data(),d=c.projectId;return c.propertyId&&await g.adminDb.collection("properties").doc(c.propertyId).update({plotId:h.FieldValue.delete(),updatedAt:h.FieldValue.serverTimestamp()}),await g.adminDb.collection("plots").doc(a).delete(),(0,e.revalidatePath)(`/admin/projects/${d}`),(0,e.revalidatePath)(`/projects/${d}`),{success:!0}}catch(a){return console.error("Error deleting plot:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء حذف القطعة"}}}async function p(a,b){try{return await (0,f.requireAdmin)(),i.plotLinkingSchema.parse({plotId:a,propertyId:b}),await g.adminDb.runTransaction(async c=>{let d=g.adminDb.collection("plots").doc(a),e=await c.get(d);if(!e.exists)throw Error("القطعة غير موجودة");let f=e.data().propertyId;if(c.update(d,{propertyId:b||h.FieldValue.delete(),updatedAt:h.FieldValue.serverTimestamp()}),f){let a=g.adminDb.collection("properties").doc(f);c.update(a,{plotId:h.FieldValue.delete(),updatedAt:h.FieldValue.serverTimestamp()})}if(b){let d=g.adminDb.collection("properties").doc(b);if(!(await c.get(d)).exists)throw Error("العقار غير موجود");c.update(d,{plotId:a,updatedAt:h.FieldValue.serverTimestamp()})}}),(0,e.revalidatePath)("/admin/projects"),(0,e.revalidatePath)("/admin/properties"),{success:!0}}catch(a){return console.error("Error linking plot to property:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء ربط القطعة بالعقار"}}}async function q(a){try{let b=(await g.adminDb.collection("plots").where("projectId","==",a).get()).docs.map(a=>{let b=a.data();return{id:a.id,projectId:b.projectId,number:b.number,status:b.status,price:b.price,currency:b.currency,polygon:b.polygon,dimensions:b.dimensions,notes:b.notes,propertyId:b.propertyId,createdAt:b.createdAt?.toDate()||new Date,updatedAt:b.updatedAt?.toDate()||new Date}}).sort((a,b)=>a.number.localeCompare(b.number));return{success:!0,data:b}}catch(a){return console.error("Error getting project plots:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء جلب قطع المشروع"}}}async function r(){try{let a=(await g.adminDb.collection("properties").where("status","==","available").get()).docs.map(a=>{let b=a.data();return{id:a.id,titleAr:b.titleAr}}).sort((a,b)=>a.titleAr.localeCompare(b.titleAr));return{success:!0,data:a}}catch(a){return console.error("Error getting available properties:",a),{success:!1,error:a instanceof Error?a.message:"حدث خطأ أثناء جلب العقارات المتاحة"}}}[f,g,h]=l.then?(await l)():l,(0,k.ensureServerEntryExports)([m,n,o,p,q,r]),(0,d.registerServerReference)(m,"40ebea0ff22de2082cf300ee15dc97984d62a4bd70",null),(0,d.registerServerReference)(n,"602d65432c66f285cc8112669f662fcaea7545e3cd",null),(0,d.registerServerReference)(o,"40a21f67a9d1a49cd1781a713893231176d8569125",null),(0,d.registerServerReference)(p,"6020233e3e7574d2e18276e4bab419dbaf089716bb",null),(0,d.registerServerReference)(q,"4082a1638e3b0c05ba67fe171c1f4a1b23b60ecb51",null),(0,d.registerServerReference)(r,"00c433db4a47e9fa754a1440b9b8af2979655f1666",null),c()}catch(a){c(a)}},!1),26614,a=>a.a(async(b,c)=>{try{a.s([]);var d=a.i(16068),e=a.i(37540),f=b([d,e]);[d,e]=f.then?(await f)():f,c()}catch(a){c(a)}},!1),32126,a=>a.a(async(b,c)=>{try{a.s(["00c433db4a47e9fa754a1440b9b8af2979655f1666",()=>f.getAvailableProperties,"4082a1638e3b0c05ba67fe171c1f4a1b23b60ecb51",()=>f.getProjectPlots,"40a21f67a9d1a49cd1781a713893231176d8569125",()=>f.deletePlot,"40b8cabe640f45d0ff374ba39eef08ff3e3159366f",()=>e.getProject,"40ebea0ff22de2082cf300ee15dc97984d62a4bd70",()=>f.createPlot,"602d65432c66f285cc8112669f662fcaea7545e3cd",()=>f.updatePlot]);var d=a.i(26614),e=a.i(16068),f=a.i(37540),g=b([d,e,f]);[d,e,f]=g.then?(await g)():g,c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__c97ff245._.js.map