module.exports=[12558,a=>{"use strict";a.s(["default",()=>H],12558);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(5050),f=(0,e.createServerReference)("40b8cabe640f45d0ff374ba39eef08ff3e3159366f",e.callServer,void 0,e.findSourceMapURL,"getProject"),g=(0,e.createServerReference)("4082a1638e3b0c05ba67fe171c1f4a1b23b60ecb51",e.callServer,void 0,e.findSourceMapURL,"getProjectPlots"),h=(0,e.createServerReference)("00c433db4a47e9fa754a1440b9b8af2979655f1666",e.callServer,void 0,e.findSourceMapURL,"getAvailableProperties"),i=(0,e.createServerReference)("40ebea0ff22de2082cf300ee15dc97984d62a4bd70",e.callServer,void 0,e.findSourceMapURL,"createPlot"),j=(0,e.createServerReference)("602d65432c66f285cc8112669f662fcaea7545e3cd",e.callServer,void 0,e.findSourceMapURL,"updatePlot"),k=(0,e.createServerReference)("40a21f67a9d1a49cd1781a713893231176d8569125",e.callServer,void 0,e.findSourceMapURL,"deletePlot"),l=a.i(99570),m=a.i(91119),n=a.i(86304),o=a.i(24987),p=a.i(70106);let q=(0,p.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),r=(0,p.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),s=(0,p.default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var t=a.i(81560),u=a.i(67552),v=a.i(30129),w=a.i(95245),x=a.i(59501),y=a.i(88507),z=a.i(66718),A=a.i(70430),B=a.i(29246),C=a.i(80701),D=a.i(24348),E=a.i(97710);function F({plot:d,projectId:e,onSubmit:f,onCancel:g,isLoading:h=!1,availableProperties:i=[]}){let[j,k]=(0,c.useState)(""),[n,o]=(0,c.useState)(null),{register:p,handleSubmit:q,setValue:r,watch:s,formState:{errors:t}}=(0,w.useForm)({resolver:(0,x.zodResolver)(y.plotSchema),defaultValues:{projectId:e,number:d?.number||"",status:d?.status||"available",price:d?.price||0,currency:d?.currency||"SAR",polygon:d?.polygon||[],notes:d?.notes||"",propertyId:d?.propertyId||""}}),v=s("polygon");(0,c.useEffect)(()=>{v&&v.length>=3?a.A(45829).then(({calculateArea:a,calculatePerimeter:b})=>{o({area:a(v),perimeter:b(v)})}):o(null)},[v]);let F=async a=>{try{k(""),await f(a)}catch(a){k(a instanceof Error?a.message:"حدث خطأ غير متوقع")}};return(0,b.jsxs)(m.Card,{className:"w-full max-w-2xl mx-auto",children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:d?"تعديل القطعة":"إضافة قطعة جديدة"})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{onSubmit:q(F),className:"space-y-6",children:[j&&(0,b.jsx)(D.Alert,{variant:"destructive",children:(0,b.jsx)(D.AlertDescription,{children:j})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"number",children:"رقم القطعة *"}),(0,b.jsx)(z.Input,{id:"number",...p("number"),placeholder:"مثال: A-1, B-12",autoComplete:"off"}),t.number&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:t.number.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"status",children:"الحالة *"}),(0,b.jsxs)(C.Select,{value:s("status"),onValueChange:a=>r("status",a),children:[(0,b.jsx)(C.SelectTrigger,{children:(0,b.jsx)(C.SelectValue,{placeholder:"اختر الحالة"})}),(0,b.jsx)(C.SelectContent,{children:Object.entries(u.PLOT_STATUS_LABELS).map(([a,c])=>(0,b.jsx)(C.SelectItem,{value:a,children:c},a))})]}),t.status&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:t.status.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"price",children:"السعر *"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(z.Input,{id:"price",type:"number",...p("price",{valueAsNumber:!0}),placeholder:"0",className:"flex-1"}),(0,b.jsxs)(C.Select,{value:s("currency"),onValueChange:a=>r("currency",a),children:[(0,b.jsx)(C.SelectTrigger,{className:"w-24",children:(0,b.jsx)(C.SelectValue,{})}),(0,b.jsx)(C.SelectContent,{children:Object.entries(u.CURRENCY_LABELS).map(([a,c])=>(0,b.jsx)(C.SelectItem,{value:a,children:c},a))})]})]}),t.price&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:t.price.message})]}),n&&(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,b.jsx)("h4",{className:"font-medium mb-2",children:"الأبعاد المحسوبة"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-600",children:"المساحة:"}),(0,b.jsx)("span",{className:"font-medium mr-2",children:(0,E.formatArea)(n.area)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-600",children:"المحيط:"}),(0,b.jsx)("span",{className:"font-medium mr-2",children:(0,E.formatPerimeter)(n.perimeter)})]})]})]}),i.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"propertyId",children:"ربط بعقار موجود (اختياري)"}),(0,b.jsxs)(C.Select,{value:s("propertyId")||"",onValueChange:a=>r("propertyId",a||void 0),children:[(0,b.jsx)(C.SelectTrigger,{children:(0,b.jsx)(C.SelectValue,{placeholder:"اختر عقار للربط"})}),(0,b.jsxs)(C.SelectContent,{children:[(0,b.jsx)(C.SelectItem,{value:"",children:"لا يوجد ربط"}),i.map(a=>(0,b.jsx)(C.SelectItem,{value:a.id,children:a.titleAr},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"notes",children:"ملاحظات"}),(0,b.jsx)(B.Textarea,{id:"notes",...p("notes"),placeholder:"ملاحظات إضافية...",rows:3}),t.notes&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:t.notes.message})]}),t.polygon&&(0,b.jsx)(D.Alert,{variant:"destructive",children:(0,b.jsx)(D.AlertDescription,{children:t.polygon.message})}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsx)(l.Button,{type:"submit",disabled:h,className:"flex-1",children:h?"جاري الحفظ...":d?"تحديث":"إضافة"}),(0,b.jsx)(l.Button,{type:"button",variant:"outline",onClick:g,disabled:h,className:"flex-1",children:"إلغاء"})]})]})})]})}var G=a.i(6015);function H({params:a}){let e=(0,d.useRouter)(),[p,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1);a.then(a=>a.id),(0,c.useEffect)(()=>{!async function(){try{C(!0);let b=(await a).id,[c,d,e]=await Promise.all([f(b),g(b),h()]);if(!c.success||!c.data)return void I("المشروع غير موجود");w(c.data),y(d.success&&d.data||[]),A(e.success&&e.data||[])}catch(a){I("حدث خطأ أثناء تحميل البيانات"),console.error("Error loading data:",a)}finally{C(!1)}}()},[a]);let P=(0,c.useCallback)(async(a,b)=>{if(p){O(!0);try{let c=await i({projectId:p.id,number:b,status:"available",price:0,currency:"SAR",polygon:a,dimensions:{area:0,perimeter:0},notes:""});c.success&&c.data?(y(a=>[...a,c.data]),K(null),M(!1)):I(c.error||"فشل إنشاء القطعة")}catch(a){I("حدث خطأ أثناء إنشاء القطعة"),console.error("Error creating plot:",a)}finally{O(!1)}}},[p]),Q=(0,c.useCallback)(a=>{K(a),M(!0)},[]),R=(0,c.useCallback)(async a=>{O(!0);try{let b=await j(a.id,a);b.success&&b.data?(y(c=>c.map(c=>c.id===a.id?b.data:c)),K(null),M(!1)):I(b.error||"فشل تحديث القطعة")}catch(a){I("حدث خطأ أثناء تحديث القطعة"),console.error("Error updating plot:",a)}finally{O(!1)}},[]),S=(0,c.useCallback)(async a=>{if(confirm("هل أنت متأكد من حذف هذه القطعة؟")){O(!0);try{let b=await k(a);b.success?(y(b=>b.filter(b=>b.id!==a)),K(null),M(!1)):I(b.error||"فشل حذف القطعة")}catch(a){I("حدث خطأ أثناء حذف القطعة"),console.error("Error deleting plot:",a)}finally{O(!1)}}},[]),T=(0,c.useCallback)(()=>{K(null),M(!1)},[]);if(B)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),(0,b.jsx)("p",{children:"جاري تحميل المشروع..."})]})});if(H)return(0,b.jsx)(D.Alert,{variant:"destructive",children:(0,b.jsx)(D.AlertDescription,{children:H})});if(!p)return(0,b.jsx)(D.Alert,{variant:"destructive",children:(0,b.jsx)(D.AlertDescription,{children:"المشروع غير موجود"})});let U={total:x.length,available:x.filter(a=>"available"===a.status).length,sold:x.filter(a=>"sold"===a.status).length,reserved:x.filter(a=>"reserved"===a.status).length};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:p.name}),(0,b.jsx)("p",{className:"text-muted-foreground",children:p.description||"لا يوجد وصف"})]}),(0,b.jsx)(l.Button,{variant:"outline",onClick:()=>e.push("/admin/projects"),children:"العودة للمشاريع"})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:"إحصائيات المشروع"})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,b.jsx)(r,{className:"h-5 w-5 text-primary"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"إجمالي القطع"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:U.total})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,b.jsx)(n.Badge,{style:{backgroundColor:u.PLOT_STATUS_COLORS.available},className:"h-5 w-5 flex items-center justify-center text-white"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"متاحة"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:U.available})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,b.jsx)(n.Badge,{style:{backgroundColor:u.PLOT_STATUS_COLORS.sold},className:"h-5 w-5 flex items-center justify-center text-white"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"مباعة"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:U.sold})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,b.jsx)(n.Badge,{style:{backgroundColor:u.PLOT_STATUS_COLORS.reserved},className:"h-5 w-5 flex items-center justify-center text-white"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"محجوزة"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:U.reserved})]})]})]})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"الخريطة التفاعلية"}),(0,b.jsx)(m.CardDescription,{children:"اضغط على الخريطة لرسم القطع الجديدة أو انقر على القطع الموجودة لعرض التفاصيل"})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsx)(v.default,{project:p,plots:x,mode:"edit",onPlotDraw:P,onPlotClick:Q,onPlotUpdate:R,onPlotDelete:S,selectedPlotId:J?.id,className:"rounded-lg border"})})]}),L&&(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:J?`تعديل القطعة: ${J.number}`:"إضافة قطعة جديدة"}),(0,b.jsx)(m.CardDescription,{children:J?"تعديل تفاصيل القطعة المختارة.":"أدخل تفاصيل القطعة الجديدة بعد رسمها على الخريطة."})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsx)(F,{initialData:J||void 0,projectId:p.id,properties:z,onSubmit:J?R:P,onCancel:T,isSubmitting:N,error:H})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"قائمة القطع"}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(l.Button,{onClick:()=>M(!0),children:[(0,b.jsx)(q,{className:"h-4 w-4 ml-2"}),"إضافة قطعة جديدة"]})})]})}),(0,b.jsx)(m.CardContent,{children:0===x.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(o.MapPin,{className:"h-12 w-12 mx-auto mb-4"}),(0,b.jsx)("p",{children:"لا توجد قطع في هذا المشروع حتى الآن"}),(0,b.jsx)("p",{className:"text-sm",children:'ارسم قطعة على الخريطة أو اضغط على "إضافة قطعة جديدة"'})]}):(0,b.jsxs)(G.Table,{children:[(0,b.jsx)(G.TableHeader,{children:(0,b.jsxs)(G.TableRow,{children:[(0,b.jsx)(G.TableHead,{children:"رقم القطعة"}),(0,b.jsx)(G.TableHead,{children:"الحالة"}),(0,b.jsx)(G.TableHead,{children:"السعر"}),(0,b.jsx)(G.TableHead,{children:"المساحة"}),(0,b.jsx)(G.TableHead,{children:"المحيط"}),(0,b.jsx)(G.TableHead,{children:"مرتبط بعقار"}),(0,b.jsx)(G.TableHead,{className:"text-right",children:"الإجراءات"})]})}),(0,b.jsx)(G.TableBody,{children:x.map(a=>(0,b.jsxs)(G.TableRow,{children:[(0,b.jsx)(G.TableCell,{className:"font-medium",children:a.number}),(0,b.jsx)(G.TableCell,{children:(0,b.jsx)(n.Badge,{style:{backgroundColor:u.PLOT_STATUS_COLORS[a.status]},className:"text-white",children:u.PLOT_STATUS_LABELS[a.status]})}),(0,b.jsxs)(G.TableCell,{children:[a.price.toLocaleString()," ",a.currency]}),(0,b.jsx)(G.TableCell,{children:(0,E.formatArea)(a.dimensions.area)}),(0,b.jsx)(G.TableCell,{children:(0,E.formatPerimeter)(a.dimensions.perimeter)}),(0,b.jsx)(G.TableCell,{children:a.propertyId?(0,b.jsx)(n.Badge,{variant:"outline",children:a.propertyId}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"-"})}),(0,b.jsx)(G.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>Q(a),children:(0,b.jsx)(s,{className:"h-4 w-4"})}),(0,b.jsx)(l.Button,{variant:"destructive",size:"sm",onClick:()=>S(a.id),children:(0,b.jsx)(t.Trash2,{className:"h-4 w-4"})})]})})]},a.id))})]})})]})]})}}];

//# sourceMappingURL=src_app_admin_projects_%5Bid%5D_page_tsx_557f5e48._.js.map